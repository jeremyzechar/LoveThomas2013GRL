clear all;

%% Get EQ count per month/year (including "zero months")
NEICdecluster = load('NEIC-decluster');


[A,a,c] = unique(NEICdecluster(:,1:2),'rows');
n = hist(c,length(a))';

EQs_mon = [A n];

j = 1;
for year=min(NEICdecluster(:,1)):max(NEICdecluster(:,1))
    for month=1:12
        YM = [year month];
        cnt = nnz(ismember(NEICdecluster(:,1:2),YM,'rows'));
        EQs_mon(j,:) = [YM cnt];
        j = j + 1;
    end
end


% do per year

j = 1;
for year=min(NEICdecluster(:,1)):max(NEICdecluster(:,1))
        subs = find(EQs_mon(:,1)==year);
        cnt = sum(EQs_mon(subs,3));
        EQs_year(j,:) = [year cnt];
        j = j + 1;
end



%% Rewrite mon-group-num (SSN)

% SSN_mon = importdata('mon-group-num');

fid = fopen('mon-group-num');
c = textscan(fid, '%f %f %f %f %f');
fclose(fid);

SSN_mon = cell2mat(c(:,[1 2 4]));

RND = 5;

SSN_monRND = [SSN_mon(:,1:2) round(SSN_mon(:,3)/RND)*RND];

% do per year
j = 1;
for year=min(SSN_mon(:,1)):max(SSN_mon(:,1))
        subs = find(SSN_mon(:,1)==year);
        cnt = mean(SSN_mon(subs,3));
        SSN_year(j,:) = [year cnt];
        j = j + 1;
end
SSN_yearRND = [SSN_year(:,1) round(SSN_year(:,2)/RND)*RND];



%% PLOT

figure
plot(EQs_mon(:,3),SSN_monRND(:,3),'.')
figure
plot(EQs_year(:,2),SSN_yearRND(:,2),'.')
xlabel('EQ count per year')
ylabel('average sunspot number per year')



%% OUT

% fout = fopen('mon-EQs.dat','w');
% for i = 1:length(EQs_mon)
%     fprintf(fout,'%4d %2d %2d\n',EQs_mon(i,:));
% end
% fclose(fout);
% 
% fout = fopen('year-EQs.dat','w');
% for i = 1:length(EQs_year)
%     fprintf(fout,'%4d %2d\n',EQs_year(i,:));
% end
% fclose(fout);
% 
% fout = fopen('mon-SSN.dat','w');
% for i = 1:length(SSN_mon)
%     fprintf(fout,'%4d %2d %3.1f\n',SSN_mon(i,:));
% end
% fclose(fout);
% fout = fopen(sprintf('mon-SSN-rnd-%d.dat',RND),'w');
% for i = 1:length(SSN_monRND)
%     fprintf(fout,'%4d %2d %3d\n',SSN_monRND(i,:));
% end
% fclose(fout);
%
% fout = fopen('year-SSN.dat','w');
% for i = 1:length(SSN_year)
%     fprintf(fout,'%4d %3.1f\n',SSN_year(i,:));
% end
% fclose(fout);
% fout = fopen(sprintf('year-SSN-rnd-%d.dat',RND),'w');
% for i = 1:length(SSN_yearRND)
%     fprintf(fout,'%4d %3d\n',SSN_yearRND(i,:));
% end
% fclose(fout);